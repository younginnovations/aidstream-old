<?php
    $identity = $this->userInfo();
    if($identity->role == 'user'){
        $model = new Model_Wep();
        $userPermission = $model->getUserPermission($identity->user_id);
    }
    
?>

<?php if($this->activities_info):?>
<div>
<table>
<tr>
    <td>Version: </td><td><?php print $this->activities_info['@version'];?></td>
</tr>
<tr>
    <td>Generated Date Time: </td><td><?php print $this->activities_info['@generated_datetime'];?></td>
</tr>
</table>
</div>
<?php endif;?>

<?php $i = 1;?>

<?php if($this->activity_array):?>
<div class = "activity-list">
    <table class ="activity-list-table">
        <thead>
            <tr>
                <th></th><th>S.N.</th><th>Title</th><th>Activity Identifier</th><th>Last Updated</th><th>State</th>
            </tr>
        </thead>
        <tbody>
        <?php foreach($this->activity_array as $eachActivity):?>
            <tr class="activity-row1">
                <td><input type="checkbox" name="activity_<?php echo $eachActivity['id']?>" value="<?php echo $eachActivity['id']?>"<?php ($eachActivity['status_id'] == Iati_WEP_ActivityState::STATUS_CHECKED)? print("checked='checked'"): print("disabled='disabled'");?>" /></td>
                <td class="sn"><?php print $i;?></td>
                <td class="title"><div class='title-activity'><?php print $eachActivity['title'];?></div>
                <?php if($userPermission):?>
                    <div class = "list-action">
                        <?php $permission = $userPermission->hasPermission(Iati_WEP_PermissionConts::EDIT_ACTIVITY_ELEMENTS);
                        if($permission == '1'){
                            print $this->l('View', 'wep/view-activity/'.$eachActivity['id']);
                        }
                        $permission = $userPermission->hasPermission(Iati_WEP_PermissionConts::DELETE_ACTIVITY);
                        if($permission == '1'){
                            print $this->l('Delete', 'wep/delete-activity/?classname=Activity&activity_id='.$eachActivity['id'],
                           array('attributes' => array('onclick' => "javascript: return confirm('Do you really want to delete?')")));
                        }
                        ?>
                        
                    </div>
                <?php endif;?>
                
                <?php if(!$userPermission):?>
                <div class = "list-action">
                <?php print $this->l('View', 'wep/view-activity/'.$eachActivity['id'])?>
                <?php //print $this->l('Edit', 'wep/edit-activity/?activity_id='.$eachActivity['id'])?>
                <?php print $this->l('Delete', 'wep/delete-activity/?classname=Activity&activity_id='.$eachActivity['id'],
                                     array('attributes' => array('onclick' => "javascript: return confirm('Do you really want to delete?')")))?>
                </div>
                <?php endif; ?>
                <div class='clearfix'></div>
                </td>
                <td class="iati-identifier"><?php print $eachActivity['identifier'];?></td>
                <td class="last-updated"><?php print $eachActivity['last_updated_datetime'];?></td>
                <td class="status <?php echo strtolower(str_replace(" ", "-",Iati_WEP_ActivityState::getStatus($eachActivity['status_id'])));?>">
                <?php echo Iati_WEP_ActivityState::getStatus($eachActivity['status_id']);?></td>
            </tr>
            
         <?php $i++;?>
        <?php endforeach;?>
        </tbody>
    </table>
</div>
<?php print $this->status_form->render();?>
<?php else: ?>
<div class="no-data">No activity has been created. Please click on <?php echo $this->l('Add New Activity' , 'wep/add-activity');?> to create new activity.</div>
<?php endif;?>

